# === 阶段 1：使用已有的镜像作为基础 ===
# 这里你需要替换成你已经建好的完整镜像名称和标签
FROM models_llm31_8b:202508 AS old_image

# === 阶段 2：创建新的、轻量级的最终镜像 ===
FROM python:3.10-slim-bookworm

WORKDIR /app

# 从旧镜像中复制已安装的 Python 库
# 这会把旧镜像中 /usr/local/lib/python3.10/site-packages/ 目录下的所有文件复制过来
COPY --from=old_image /usr/local/lib/python3.10/site-packages/ /usr/local/lib/python3.10/site-packages/

# 复制其他必要文件 (如果存在的话)
# COPY --from=old_image /path/to/your/app /app

# 挂载模型目录
VOLUME ["/models"]
EXPOSE 8000

# 启动命令
CMD ["python", "-m", "vllm.entrypoints.openai.api_server", \
     "--model", "/models/Llama-3.1-8B", \
     "--port", "8000", \
     "--device", "cpu"]
